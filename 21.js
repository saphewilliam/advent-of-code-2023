const input = `...................................................................................................................................
.#..#..#.....#....#.#..#.......#...............#...........#...................##...........#.........#............#.#....#....#...
...##.#..#.....#.......#.......#....................#..#.......................#.....#.#...#.......................##.#....#.#.....
..#.........................#.........#...##.....##..#...#...................#.............#.....#.........##........#.............
....#.#...#.............#...........#........#...#..#....#................#....#....#........#............#........#...............
..#.......##........#...#........#..#.......................................#....#......................#...#..#....#.#..........#.
......#.#....#...................#......#.....##.......#..........#..........#..#.............#...#...#.#..#..#.#..#...#......#.##.
.#...........#.............##...#...##.#............................#.......#...##.....#...#..#......#.............................
........#...#.............#...#.....##..#......................##.................#..#..##..#.........#.........#............#.....
....#..#.##.#...#......#...#..............#...##.#..#..........#...............##..........#......#........##.#....#.....#.........
....#..#.....##....#.......................#.......#..............#..............#..#..#.............#........#...#..##............
...#.......#....#....#...#.#...#.#..........#...#..........#....#........................##..........#...#...#...#.................
...#.#.....#.........#....#.....##..............#....................####.............................#....#......##...#.....#.....
.#..#......................#..............#.............#.#...###.#.##....#...................#.......#.....##......#..........#...
..........#.#.#...........###............................#......................................#.........#..#..#........#.......#.
............#.......#....................................#...........#.#.............#...........#.#..#...#...#.........#..........
..........#.............#.....#....#.#.....#...................#....#.................#..........#............#.......##.......#...
...##........#...#..#......#.........................##.............##.###............#..........#........#..#...#...#.............
...........##......#.#....###.............#...............#.......#...#................#................#.#......#.....##....#.....
..............#.....................................#.............#......###..#...........#............#.#.....#...........#...#...
.................................#......................#.............#.....................#......#...##...........#......#..#..#.
.......#..#..................#.....#..............#...##.#.#.........#.........#..#...........#..........#.....#....#...##.......#.
.....#.#....#.#....................#..................#...............#..#...................#...#.......##....##......#..#.....#..
.........#.....#...#..........##.#.#...............#..........#...#..........#.....................#..............#..#.............
.......#..........#...#.....#...#....#....................#...##.......#...#..........................#.......#.......#..#..#......
........#.##........#.......#...................###..#......#...................##.......................#.........#....#..........
...........#........#............................#.........#...#..###.#......#..#.###...........#.#..#.................#..#..###...
...........#....#..#....#.................#........#..#.#....###.....#....#...#....#..#...........#...........#...#....#.#......#..
..#..#.#..#....#.###.##...#......................#.......#.....#......................#...........#.....#.#........#...........#...
..............#...........##.#.............#....#...#....#...##......##.....#........##...........#............##.#....###.........
..#..................##...#.................#.........................#..#..........#.#.#..........#....##..............#......##..
.....#..#.##......#....................#..#............#..#............##..#..............................#.#..#.....#...........#.
...###....#.....#....#....#......................##.....#..#......#..##........#.............................#.....##..............
...#..........#..#.#..#..........................#....#........#..............................................#..##...........#....
........##...#......###..#..................####..#.#...#...#......#...##....#.....#........................#.....#................
......##...........#......................#.##.#........#...........#...#......#...#..#.................#.#.......#...#..........#.
...#..........#........##.............#.............#........#.....#........#............##.....#.........#..##.#.....#......#.#...
.#..........#.#.........#..........#....................#..#....#...................#...#.....#...........#............##.....#....
................#......#........#..............#.##.......#...#....#..........#....#.....#.....#............#..#...#..##.....#..#..
...##....#..........#................##......#........##......................#.#...#.......##..#.#.#.........#.......###..........
...###.......................###.#..............#...#...#.......#.........###.....##.................#.......#....#........##..##..
............#...#...........#..#............#.......##..........................#....#...#.....#..............###........#.........
.......#.##......#.............#...#...................#....#.........#...........###......#......................#................
....###........#.#........#.#.#.....#..#........##..#.......#.#...................#.....#.#.....##....#.................#.#..#.....
.##....#..................#........#..#.........#...........................#.............#........#..#................##...#....#.
.#...........................#.............#.#.....#.#..#...............#........##...............................##....#.#........
.#.#..#....................#...............##....#.....#..............#.....................#......##..............................
..#........#.#..........#.........##....................#.........#......##..###...........#...#.....##..#..........#......###.....
......#...............#...#...#.##......##..#..#.....#...#.##.#...............#..............#...#......#.#..#..................##.
............#..........#..#.##...#.#.....#..........#..#..........#..#......##..............#......##.....................#.#.#....
...#..##.#................##.#...#...........#...........................#...#..#.#.#............#.##........##....................
....#........................................#....#..##..............#.........#..#...#......#..........#.......#........#....#....
....................#..........#.............#...........#...............#......##.......##..#.........#.......#.........#.#.......
..#.............#...##..#......................#.......#.#.#.#..#..#..#.#....#.....#..#.......#..#.........#....#..................
..#..................................#.....................#......#.#.#............#.....#..#..##....###...#.......................
...#............#...#...#.#.......#...###............................#..#................#..........#..........#................##.
....#...................#...##......#......#...........................#.#...##...........#......#..#...........#..............#...
.#............#............#.....................##...........#.......................#........................#...............#...
...........#.......#..##.##..#......#.......#.......#.....#..............................#.......#.#...#.....#.#.....#.............
..........#....#.......#...#....##.#.......#.......................#.#......#.#.........##......................#..................
..............#.................#..#.#..#.#.........##..#....#....#...#..........#.....#.#..#.....................#..#.#.........#.
..................#.....................#..###.#....#.#.............#..##..#.#.##.#.............#.#..#......#.#..##..##.##.........
.............#.....#....#..........#........#.....#.....##..###..........#.......#.#.....................#....#...#...##...........
......#............#....#.#..#..#......##..........#.#.......#...........#.#....#.....#...#...........#...#.......#.......#........
......................#....................#......#............#...#.......#.......#.#.#.#.........#......#......#..#..............
.................................................................S.................................................................
........#.....#...#..................#..#..............##....###..............#.#...........#...#.#.#.#.#........#.#.#...#...#.....
.........#...........#............#.##...#...#..........#.....#..............#...#......##..#..#.......#..#.#.##.....#..#..........
.......#.........#.#..................#...#........................#..............#...........#.#.#.........#.............#........
............####..........#..........#........#....#.....#...........#...........#..##..#..................#...#......#............
...............................#..##......#....#.#......................#........#.#..#.#..............#.....#.#...................
..........#.#...#...##.............#..#..#....#.......#..##.........##...##......#.........#...#...##........#.##..#...............
.................#..............#......#...#...#..##..........#..........#...#....#.................#......###.#..##.#..........#..
....#........#...#........#.....#..#...#...##........#.....#................#.....#.#.....#......................#...#..........##.
...##...........#........#................#..##.....#...#.#...#....................#...........#.....#...............#..........#..
...#..............##...............................#.....#...........#...###............#....#............#.#.#....##..............
...#...........##...#......#......####..##......#....#......#..##...#..#...........##..................#...##.#.#..#..........#....
..........................#....#....#..##.......#.............#...#..###..#..#.....................###....#...............#...##...
.......##........#...#....##...........#......#..............##.....##.....#..#.#...#.....#...........##.........................#.
...#..............##.#..#.#.........................................#....#............#....#.........#.............................
..#....................#..........#.....#...#.........#.....#..............#.....#.....#......#...#.#.....###.#.............#......
.......##..#...........#........##......#...#..##.....................#.#...#...#........#...............................#....#....
......#...#.....................#..................#.........#......#..#....#..###..#.............#.....#.................#..#.#...
.#....#.#.............#......#.........#...#.............#...#...........#....#..........#......#.#..#..................#........#.
....#...#.................#....#..#...#.......#..#...#.........#..#.#.#.......#....#...#...............#...#..................#..#.
.......................................#........#..#....#...#.......#.....#...#..#..............#.#...#..#.........#..##..#....#...
...##...#.................#.#.#..#.....#..##....#..#...................#..................#..#.#...#..................#.......#....
....#....#.#...#.....................#...........#......#...#................#................#.........#..........#.#...........#.
...#..##...#...##.##..........#.......#..#...#..........#.#.......#.#.........#.#.......#..#........#.#.........##.#.....#..#......
...................#.................#.#.#...#...#.#.##.....#.........#......#.#...#..............#.............#.............#....
..#...#............#...........#....##........#.......#.......#.......#......................................#....#..............#.
....................##...............#.#................#..........#...#.............##...#..#................#.......#.#...#......
.#.............#........................#.......#....#..#.#..........#..#.......................#..................#.#....#...#.##.
...#....#...............#........#....##.........#.........#........#....#.......##.......#..#...............#................###..
.#......#.#....#..#.#.#..............#..............#..........#.........................#...#..................#...#.........#.#..
..#...........#...#.......................#........#.......#........#.#....#.............#...#............#.......#......#.##...#..
..#....#...........#.............................#.....#..#.#...#.................#..#........#............#..##.......#.....#.....
.#.......#........#...#.....#........#.......#.....#.....#........#.........#...#...........#.#.........#.#........##.......#......
...#.....#...#.............##............................................#...#........#....#.........##..........#.###.#.#.....#...
.#...#..#.......................................#...........#.......#.##..#.....##......#.............#...#...#.#........#.........
..................#..........##.........#...........#..#.......#........#.#..........#....#............#..............#.#....#.....
..#.........#...........#.#...............#.#.....###......#.#....#...........#..........................#..................#......
.##.#......#...#...#..........#...........#........#.......#.#.....#..#.....#..#......##.........#.#...#...#..........#.....#......
...........##....#...#.....#.#.#...........#...#..#.......#............#..#....#.......................#....#..#..#.....##...#.#...
.#...##...#.........##.......#.##.#...........#......#.....#..........#...#...##......#..................#..#.............#........
............#.#..#.......#...##..#............#.......#...#.#..............#....#....#...................#.##..#......#.........#..
........##.#..#....#.#.#............................#.#..............##........#.#.................#.....#..#.#.....#..............
...#.........#..........#.#...................#.................#.##................#.........#..#...#.#..#.#.#..............#.....
...#.........##......##...#..........................#......#.......#......................................#.##..#..#........##....
.....#.#....#...#....#.#..#...##.......#..........#....#.....#........#........##.#...............#...#....#...#........#.......#..
.##....................................................#..#..............#....................#..#..#..###.....#..##......#....#...
..#..#.....#.#........#.........#.#........................##..#...............#........#..#..#......#...#...#.....................
.....#....##......#...#..........#.................#............#.#.........#............#........#........#.#...#...#.............
............##.#.....................................#......#........#.##.#....................#.......#.....#.....##...........##.
...#.........#.....#...#..............#....#.#..........#....##.........#.#..#............#.......................##..#.......#....
.#..#.........#.........##..#.##..............#............#....#..........#.........#...##.....#.....#.#....#.........#...........
..............#..#...#...##........#...#.#....#..............#..#...#.#............#...........#..........#...........##.#.........
....#....#........##.........#........#..#.#.#.............#.#....##.#.#...........#.........#..#...###.....#..#...#............#..
..........#...........#........##.#......................#..........#................#..............#............##.....#..........
...........#.....#............#.##.......#........................#...##........#.#....##....#.#...............#...#......#......#.
...#.....#..............#....#..#....#......#.....................#....#...................#...#.......##...#.......#.......#....#.
.#........#.......###........##.#.........##........#..............#..........##...#.......#.#.........#..#..#.#...##.....#....##..
..#....#.......#..#.....#...............#.#....#................#..#...................#...#.............#....#.....#..#.....#.....
......#.##.#..#.#......#.............#................#.......#..........................#.......#....#...#.#..#...#......#.#......
...#.....#..##.#.....#.#..............##....#....##...#...........................#..................#......#...#.....#.#.##.......
.#...#..............#...#..#....#.#..............#.#..............................###.....#.....#.......#.....#....#...............
..#...#.....#...#.#..##...#...##......#.#............#........................#..........#....#............................#.......
...........#..##........#..#.......#.......#......#............................##..#..#..#....#....#...........##..##..##.....#....
........#.#.#.........#...........#....#..#...#..#.......#..............#.....#.#................#..........#.#.#........####...#..
...#...#.#.#....#............#.......#.......#....#.....#......................#...#....#..........#..........#.#.......#...#...#..
...................................................................................................................................`

const testInput = `...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`;

// const currentInput = testInput.split('\n');
const currentInput = input.split('\n');

function getStartState() {
  for (let y = 0; y < currentInput.length; y++) 
    for (let x = 0; x < currentInput[y].length; x++) 
      if (currentInput[y][x] === 'S') 
        return [x, y, 0];
        
}

function move(p, dir) {
  switch(dir) {
    case 'up':
      return [p[0], p[1] - 1];
    case 'right':
      return [p[0] + 1, p[1]];
    case 'down':
      return [p[0], p[1] + 1];
    case 'left':
      return [p[0] - 1, p[1]];
    default:
      return [p[0], p[1]];
  }
}


function isInBounds(x, y) {
  return !(y < 0 || y >= currentInput.length || x < 0 || x >= currentInput[0].length);
}

function wrap(i, range) {
  return ((i % range) + range) % range;
}

function getStateEdges(state) {
  const [pX, pY, s] = state;
  const p = [pX, pY];
  const edges = [];
  for (const dir of ['up', 'right', 'down', 'left']) {
    const [x, y] = move(p, dir);
    if (isInBounds(x, y) && currentInput[y][x] !== '#') edges.push([x, y, s + 1]);
  }
  return edges
}

function getCacheKey(state) {
  return `${state[0]},${state[1]}`;
}

function cacheHas(cache, state) {
  const key = getCacheKey(state);
  return cache[key] !== undefined;
}

function cacheSet(cache, state) {
  const key = getCacheKey(state);
  cache[key] = state[2];
  return cache;
}

function cacheGet(cache, p) {
  const key = getCacheKey(p);
  return cache[key] ?? null;
} 

function bfs(args) {
  const {start, steps} = args;
  const startState = start ? [start[0], start[1], 0] : getStartState()
  const q = [startState];
  let c = {};

  while (q.length > 0) {
    const item = q.shift();
    if (item[2] === steps) continue;
    for (const e of getStateEdges(item)) {
      if (!cacheHas(c, e)) {
        c = cacheSet(c, e);
        q.push(e);
      }
    }
  }

  return c;
}

function count(cache, isEven = true) {
  return Object.values(cache).filter((v) => v % 2 === (isEven ? 0 : 1)).length
}

// Part 1
console.log(count(bfs({steps: 64})))

// Part 2
const cbr = bfs({start: [currentInput[0].length - 1, currentInput.length - 1]})
// const cb = bfs({start: [currentInput[0].length - 1, currentInput.length - 1]})
const cbl = bfs({start: [0, currentInput.length - 1]})
// const cl = bfs({start: [currentInput[0].length - 1, currentInput.length - 1]})
const ctl = bfs({start: [0, 0]})
// const ct = bfs({start: [currentInput[0].length - 1, currentInput.length - 1]})
const ctr = bfs({start: [currentInput[0].length - 1, 0]})
// const cr = bfs({start: [currentInput[0].length - 1, currentInput.length - 1]})

const filledEven = count(cbr, true)
const filledOdd = count(cbr, false)

const edges = ['br', 'b', 'bl', 'l', 'tl', 't', 'tr', 'r'];

const steps = {
  brb: 0,
  brbl: 0,
  brl: 0,
  brtl: 0,
  brt: 0,
  brtr: 0,
  brr: 0,
}


const [xMin, xMax, yMin, yMax] = Object.keys(cbr).reduce((p, c) => {
  const [x, y] = c.split(',').map((v) => parseInt(v));
  p[0] = Math.min(p[0], x);
  p[1] = Math.max(p[1], x);
  p[2] = Math.min(p[2], y);
  p[3] = Math.max(p[3], y);
  return p

}, [Infinity, -Infinity, Infinity, -Infinity])

for (let y = yMin; y <= yMax; y++) {
  let line = '';
  for (let x = xMin; x <= xMax; x++) {
    let char = currentInput[wrap(y, currentInput.length)][wrap(x, currentInput[0].length)]
    if (char !== 'S' && cacheHas(cbr, [x, y])) char = 'X';
    line += char
  }
  console.log(line);
}

// IDK man
